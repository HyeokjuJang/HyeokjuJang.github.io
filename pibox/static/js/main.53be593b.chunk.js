(this.webpackJsonppibox=this.webpackJsonppibox||[]).push([[0],{1:function(e,t){e.exports={PREFIX:"00000000-0000-0000-0000-",SERVICE_ID:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0000",SERVICE_NAME:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0001",DEVICE_MODEL:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0002",WIFI_NAME:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0003",IP_ADDRESS:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0004",INPUT:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0005",NOTIFY_MESSAGE:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0006",INPUT_SEP:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0007",CUSTOM_COMMAND_INPUT:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0008",CUSTOM_COMMAND_NOTIFY:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0009",CUSTOM_INFO_LABEL:"FD2BCCCA",CUSTOM_INFO_COUNT:"FD2BCCAA0000",CUSTOM_INFO:"FD2BCCCB",CUSTOM_COMMAND_LABEL:"FD2BCCCC",CUSTOM_COMMAND_COUNT:"FD2BCCAC0000"}},10:function(e,t,a){},17:function(e,t,a){e.exports=a(29)},22:function(e,t,a){},29:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(7),c=a.n(i),u=(a(22),a(10),a(8)),s=a(2),o=a.n(s),l=a(3),d=a(12),f=a(13),m=a(15),p=a(14),h=a(16),C=a(6),E=a.n(C),v=a(9);function b(e){var t=e.ipAddress,a=Object(n.useState)(!1),i=Object(v.a)(a,2),c=i[0],u=i[1],s=Object(n.useState)(""),o=Object(v.a)(s,2),l=o[0],d=o[1];return Object(n.useEffect)((function(){""!==t&&"..."!==t?(u(!0),d(t)):(u(!1),d(""))}),[t]),Object(n.useEffect)((function(){}),[l]),c?r.a.createElement("div",{className:"connect-panel panel"},r.a.createElement("div",{className:"panel-title"},"\ud130\ubbf8\ub110 : http://",l,":4200"),r.a.createElement("iframe",{src:"http://"+l+":4200",title:"\ud130\ubbf8\ub110",width:"100%"})):null}var A=a(1),O=a.n(A),S=function(e){function t(e){var a;for(var n in Object(d.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).connectDevice=function(){navigator.bluetooth.requestDevice({filters:[{services:[O.a.SERVICE_ID]}]}).then((function(e){return e.gatt.connect()})).then((function(e){return a.setState({serverId:e.device.id}),e.getPrimaryService(O.a.SERVICE_ID)})).then((function(e){return a.state.isIphone?(console.log("ios webBLE"),a.webBleConnect(e)):e.getCharacteristics()})).then(function(){var e=Object(l.a)(o.a.mark((function e(t){var n,r,i,c,u,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Connected!"),n=t,a.setState({isConnected:!0}),r=[{preset:!0,uuid:"",label:"Device ID",value:a.state.serverId},{preset:!0,uuid:O.a.DEVICE_MODEL,label:"Model",value:" "},{preset:!0,uuid:O.a.WIFI_NAME,label:"Wifi",value:"..."},{preset:!0,uuid:O.a.IP_ADDRESS,label:"IP Address",value:"..."}],e.next=6,a.subscribeCharacteristic(O.a.WIFI_NAME,r,n);case 6:return e.next=8,a.subscribeCharacteristic(O.a.IP_ADDRESS,r,n);case 8:return e.next=10,a.readInfoCharacteristic(O.a.DEVICE_MODEL,r,n);case 10:return e.next=12,a.subscribeCharacteristic(O.a.NOTIFY_MESSAGE,r,n);case 12:return e.next=14,a.subscribeCharacteristic(O.a.CUSTOM_COMMAND_NOTIFY,r,n);case 14:n.filter((function(e){return e.uuid.indexOf(O.a.CUSTOM_INFO_LABEL)>=0})).map((function(e){return r.push({uuid:e.uuid.replace(O.a.CUSTOM_INFO_LABEL,O.a.CUSTOM_INFO),uuid_label:e.uuid,label:"-",value:""})})),i=0;case 16:if(!(i<r.length)){e.next=26;break}if(!r[i].preset){e.next=19;break}return e.abrupt("continue",23);case 19:return e.next=21,a.readInfoCharacteristic(r[i].uuid_label,r,n);case 21:return e.next=23,a.subscribeCharacteristic(r[i].uuid,r,n);case 23:i++,e.next=16;break;case 26:c=[],n.filter((function(e){return e.uuid.indexOf(O.a.CUSTOM_COMMAND_LABEL)>=0})).map((function(e){return c.push({uuid:e.uuid,label:"..."})})),u=c,s=0;case 30:if(!(s<u.length)){e.next=36;break}return e.next=33,a.readCommandLabel(u[s].uuid,u,n);case 33:s++,e.next=30;break;case 36:a.setState({characteristicsList:n,infoList:r,commandList:u});case 37:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch(console.log)},a.readCommandLabel=function(e,t,n){return new Promise((function(r){a.getCharacteristicInit(e,n).readValue().then((function(e){return e.buffer})).then(a.ab2str).then((function(n){var i=t;i.find((function(t){return t.uuid===e})).label=n,a.setState({commandList:i},r())}))}))},a.readInfoCharacteristic=function(e,t,n){return new Promise((function(r){a.getCharacteristicInit(e,n).readValue().then((function(e){return e.buffer})).then(a.ab2str).then((function(n){var i=t;i.find((function(t){return t.uuid===e}))&&(i.find((function(t){return t.uuid===e})).value=n),i.find((function(t){return t.uuid_label===e}))&&(i.find((function(t){return t.uuid_label===e})).label=n),i!==a.state.infoList?a.setState({infoList:i},r()):r()}))}))},a.subscribeCharacteristic=function(e,t,n){return new Promise(function(){var r=Object(l.a)(o.a.mark((function r(i){return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.getCharacteristicInit(e,n).addEventListener("characteristicvaluechanged",(function(n){if(n.target.uuid===O.a.NOTIFY_MESSAGE){var r=a.ab2str(n.target.value.buffer);C.notify.show(r,"custom",3e3,"teal")}else if(n.target.uuid===O.a.CUSTOM_COMMAND_NOTIFY){var i=a.ab2str(n.target.value.buffer);if(a.state.commandOutputShouldRefresh)a.setState({commandOutputShouldRefresh:!1,commandOutput:""},(function(){var e=a.state.commandOutput+i;e.endsWith("&#&")&&(e=e.replace("&#&",""),a.setState({commandOutputShouldRefresh:!0})),a.setState({commandOutput:e})}));else{var c=a.state.commandOutput+i;c.endsWith("&#&")&&(c=c.replace("&#&",""),a.setState({commandOutputShouldRefresh:!0})),a.setState({commandOutput:c})}}else{var u=a.ab2str(n.target.value.buffer),s=t;s.find((function(t){return t.uuid===e}))&&(s.find((function(t){return t.uuid===e})).value=u),s.find((function(t){return t.uuid_label===e}))&&(s.find((function(t){return t.uuid_label===e})).label=u),a.setState({infoList:s})}})),r.next=3,a.getCharacteristicInit(e,n).startNotifications();case 3:i();case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())},a.webBleConnect=function(e){return new Promise(function(){var t=Object(l.a)(o.a.mark((function t(n){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getCharacteristic(O.a.PREFIX+O.a.CUSTOM_INFO_COUNT).then((function(e){return e.readValue()})).then((function(e){return e.buffer})).then(a.ab2str).then(parseInt).then((function(e){console.log("custom-info-count "+e),a.setState({customInfoCount:e})}));case 2:return t.next=4,e.getCharacteristic(O.a.PREFIX+O.a.CUSTOM_COMMAND_COUNT).then((function(e){return e.readValue()})).then((function(e){return e.buffer})).then(a.ab2str).then(parseInt).then((function(t){console.log("custom-command-count "+t),a.setState({customCommandCount:t},(function(){for(var t=[],r=0;r<a.state.customInfoCount;r++){var i=(r+1).toString(16);i="0".repeat(4-i.length)+i,t.push(O.a.PREFIX+O.a.CUSTOM_INFO+i),t.push(O.a.PREFIX+O.a.CUSTOM_INFO_LABEL+i)}for(var c=[],s=0;s<a.state.customCommandCount;s++){var o=(s+1).toString(16);o="0".repeat(4-o.length)+o,c.push(O.a.PREFIX+O.a.CUSTOM_COMMAND_LABEL+o)}n(Promise.all([e.getCharacteristic(O.a.SERVICE_NAME),e.getCharacteristic(O.a.DEVICE_MODEL),e.getCharacteristic(O.a.WIFI_NAME),e.getCharacteristic(O.a.IP_ADDRESS),e.getCharacteristic(O.a.NOTIFY_MESSAGE),e.getCharacteristic(O.a.INPUT_SEP),e.getCharacteristic(O.a.CUSTOM_COMMAND_INPUT),e.getCharacteristic(O.a.CUSTOM_COMMAND_NOTIFY)].concat(Object(u.a)(t.map((function(t){return e.getCharacteristic(t)}))),Object(u.a)(c.map((function(t){return e.getCharacteristic(t)}))))))}))}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},a.ab2str=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},a.getCharacteristic=function(e){return a.state.characteristicsList.find((function(t){return t.uuid===e}))},a.getCharacteristicInit=function(e,t){return t.find((function(t){return t.uuid===e}))},a.inputWifi=function(){a.setState({key:a.state.key.trim().replace(/\|/g,"*"),ssid:a.state.ssid.trim().replace(/\|/g,"*"),password:a.state.password.trim().replace(/\|/g,"*")},(function(){var e;if(""===a.state.ssid&&(e="SSID cannot be empty."),""===a.state.password&&(e="Password cannot be empty."),e)C.notify.show(e,"custom",3e3,"teal");else{a.setState({wifiLock:!0},setTimeout((function(){a.setState({wifiLock:!1})}),4e3));var t=a.str2abs("".concat(a.state.key,"%&%").concat(a.state.ssid,"%&%").concat(a.state.password,"&#&"));a.sendSeparately(t,O.a.INPUT_SEP)}}))},a.sendCommand=function(e){var t=a.str2abs("".concat(a.state.key,"%&%").concat(e.slice(-4),"&#&"));a.sendSeparately(t,O.a.CUSTOM_COMMAND_INPUT)},a.sendSeparately=function(){var e=Object(l.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=o.a.keys(t);case 1:if((e.t1=e.t0()).done){e.next=9;break}return r=e.t1.value,e.next=5,a.getCharacteristic(n).writeValue(t[r]);case 5:return e.next=7,a.wait(.4);case 7:e.next=1;break;case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),a.wait=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e(!0)}),1e3*t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.str2abs=function(e){for(var t="",a=0;a<e.length;a++)""===t?t=e.charCodeAt(a).toString(16):t+=","+e.charCodeAt(a).toString(16);for(var n=t.split(","),r=[];n.length>0;){var i=n.splice(0,20).join(",");r.push(new Uint8Array(i.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer)}return r},a.state={supportBluetooth:Boolean(window.navigator.bluetooth),isConnected:!1,serverId:"",ssid:"",password:"",key:"pisugar",wifiLock:!1,characteristicsList:[],infoList:[],commandList:[],commandOutput:"",commandOutputShouldRefresh:!1,loading:null,charLength:-1,customInfoCount:0,customCommandCount:0,isAndroid:navigator.userAgent.indexOf("Android")>-1||navigator.userAgent.indexOf("Adr")>-1,isIphone:navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iphone")>-1},O.a)O.a[n]=O.a[n].toLowerCase();return a}return Object(h.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"BluetoothConnect"},r.a.createElement("div",{id:"app"},r.a.createElement(E.a,null),r.a.createElement("div",{className:"panel-container"},this.state.supportBluetooth?null:r.a.createElement("div",{className:"connect-panel panel"},r.a.createElement("div",{className:"panel-title"},"Cannot find web bluetooth."),r.a.createElement("p",null,"Please make sure your device and browser support web bluetooth. Please visit"," ",r.a.createElement("a",{href:"https://github.com/WebBluetoothCG/web-bluetooth/blob/master/implementation-status.md",target:"_brank"},"Here")," ","to check web-bluetooth compatibility.")),!this.state.isConnected&&this.state.supportBluetooth?r.a.createElement("div",{className:"connect-panel panel"},r.a.createElement("div",{className:"panel-title"},"PIBOX. \ub77c\uc988\ubca0\uc774\ud30c\uc774\ub97c \ube14\ub8e8\ud22c\uc2a4\ub85c \ucc3e\uc544 \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. "),r.a.createElement("div",null,r.a.createElement("button",{onClick:this.connectDevice},"\ube14\ub8e8\ud22c\uc2a4\ub85c \ucc3e\uae30"))):null,this.state.isConnected?r.a.createElement("div",{className:"info-panel panel"},r.a.createElement("div",{className:"panel-title"},"\uae30\uae30 \uc815\ubcf4"),this.state.infoList.map((function(e){return r.a.createElement("div",{key:e.uuid,className:"info-group"},r.a.createElement("div",{className:"label"},e.label),r.a.createElement("div",{className:"value"},e.value))}))):null,this.state.isConnected?r.a.createElement("div",{className:"wifi-panel panel"},r.a.createElement("div",{className:"panel-title"},"\ub77c\uc988\ubca0\ub9ac\ud30c\uc774 \uc640\uc774\ud30c\uc774 \uc124\uc815"),r.a.createElement("div",null,r.a.createElement("input",{placeholder:"\uc640\uc774\ud30c\uc774 \uc774\ub984(SSID)",value:this.state.ssid,onChange:function(t){return e.setState({ssid:t.target.value})}})),r.a.createElement("div",null,r.a.createElement("input",{placeholder:"\uc640\uc774\ud30c\uc774 \ube44\ubc00\ubc88\ud638",value:this.state.password,onChange:function(t){return e.setState({password:t.target.value})},type:"password"})),r.a.createElement("div",null,r.a.createElement("input",{placeholder:"Key (Default: pisugar)",value:this.state.key,onChange:function(t){return e.setState({key:t.target.value})}})),r.a.createElement("div",null,r.a.createElement("button",{onClick:this.inputWifi,disabled:this.state.wifiLock},"\uc640\uc774\ud30c\uc774 \uc124\uc815"))):null,this.state.isConnected?r.a.createElement("div",{className:"command-panel panel"},r.a.createElement("div",{className:"panel-title"},"\ucee4\uc2a4\ud140 \uba85\ub839\uc5b4"),this.state.commandList.length>0?r.a.createElement("div",null,r.a.createElement("div",null,this.state.commandList.map((function(t){return r.a.createElement("div",{key:t.uuid,className:"button-wrap"},r.a.createElement("button",{size:"small",onClick:function(){return e.sendCommand(t.uuid)}},t.label))}))),r.a.createElement("div",null,r.a.createElement("input",{placeholder:"Key (Default: pisugar)",value:this.state.key,onChange:function(t){return e.setState({key:t.target.value})}})),r.a.createElement("div",null,r.a.createElement("input",{type:"textarea",placeholder:"Output",value:this.state.commandOutput,readOnly:!0,rows:"10"}))):r.a.createElement("p",null,"\ucee4\uc2a4\ud140 \uba85\ub839\uc5b4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.")):null),this.state.isConnected?r.a.createElement("div",{className:"panel-container"},r.a.createElement(b,{ipAddress:void 0===this.state.infoList.find((function(e){return"IP Address"===e.label}))?"":this.state.infoList.find((function(e){return"IP Address"===e.label})).value})):null,r.a.createElement("div",{className:"copyright"},"PiBox . Open source under GPL-3.0 license.")))}}]),t}(r.a.Component);var I=function(){return r.a.createElement(S,null)};c.a.render(r.a.createElement(I,null),document.getElementById("root"))}},[[17,1,2]]]);
//# sourceMappingURL=main.53be593b.chunk.js.map