(this.webpackJsonppibox=this.webpackJsonppibox||[]).push([[0],{104:function(e,t,a){e.exports=a(289)},109:function(e,t,a){},283:function(e,t){},284:function(e,t){},285:function(e,t){},286:function(e,t){},287:function(e,t){},288:function(e,t){},289:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),i=a(63),s=a.n(i),c=(a(109),a(65),a(7)),o=a(3),u=a.n(o),l=a(6),d=a(41),f=a(42),m=a(102),h=a(101),p=a(103),b=a(43),C=a.n(b);a(9);a(64),a(10);var v=a(4),E=a.n(v),g=function(e){function t(e){var a;for(var n in Object(d.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).connectDevice=function(){navigator.bluetooth.requestDevice({filters:[{services:[E.a.SERVICE_ID]}]}).then((function(e){return e.gatt.connect()})).then((function(e){return a.setState({serverId:e.device.id}),e.getPrimaryService(E.a.SERVICE_ID)})).then((function(e){return a.state.isIphone?(console.log("ios webBLE"),a.webBleConnect(e)):e.getCharacteristics()})).then(function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,i,s,c,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Connected!"),n=t,a.setState({isConnected:!0}),r=[{preset:!0,uuid:"",label:"Device ID",value:a.state.serverId},{preset:!0,uuid:E.a.DEVICE_MODEL,label:"Model",value:" "},{preset:!0,uuid:E.a.WIFI_NAME,label:"Wifi",value:"..."},{preset:!0,uuid:E.a.IP_ADDRESS,label:"IP Address",value:"..."}],e.next=6,a.subscribeCharacteristic(E.a.WIFI_NAME,r,n);case 6:return e.next=8,a.subscribeCharacteristic(E.a.IP_ADDRESS,r,n);case 8:return e.next=10,a.readInfoCharacteristic(E.a.DEVICE_MODEL,r,n);case 10:return e.next=12,a.subscribeCharacteristic(E.a.NOTIFY_MESSAGE,r,n);case 12:return e.next=14,a.subscribeCharacteristic(E.a.CUSTOM_COMMAND_NOTIFY,r,n);case 14:n.filter((function(e){return e.uuid.indexOf(E.a.CUSTOM_INFO_LABEL)>=0})).map((function(e){return r.push({uuid:e.uuid.replace(E.a.CUSTOM_INFO_LABEL,E.a.CUSTOM_INFO),uuid_label:e.uuid,label:"-",value:""})})),i=0;case 16:if(!(i<r.length)){e.next=26;break}if(!r[i].preset){e.next=19;break}return e.abrupt("continue",23);case 19:return e.next=21,a.readInfoCharacteristic(r[i].uuid_label,r,n);case 21:return e.next=23,a.subscribeCharacteristic(r[i].uuid,r,n);case 23:i++,e.next=16;break;case 26:s=[],n.filter((function(e){return e.uuid.indexOf(E.a.CUSTOM_COMMAND_LABEL)>=0})).map((function(e){return s.push({uuid:e.uuid,label:"..."})})),c=s,o=0;case 30:if(!(o<c.length)){e.next=36;break}return e.next=33,a.readCommandLabel(c[o].uuid,c,n);case 33:o++,e.next=30;break;case 36:a.setState({characteristicsList:n,infoList:r,commandList:c});case 37:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch(console.log)},a.readCommandLabel=function(e,t,n){return new Promise((function(r){a.getCharacteristicInit(e,n).readValue().then((function(e){return e.buffer})).then(a.ab2str).then((function(n){var i=t;i.find((function(t){return t.uuid===e})).label=n,a.setState({commandList:i},r())}))}))},a.readInfoCharacteristic=function(e,t,n){return new Promise((function(r){a.getCharacteristicInit(e,n).readValue().then((function(e){return e.buffer})).then(a.ab2str).then((function(n){var i=t;i.find((function(t){return t.uuid===e}))&&(i.find((function(t){return t.uuid===e})).value=n),i.find((function(t){return t.uuid_label===e}))&&(i.find((function(t){return t.uuid_label===e})).label=n),i!==a.state.infoList?a.setState({infoList:i},r()):r()}))}))},a.subscribeCharacteristic=function(e,t,n){return new Promise(function(){var r=Object(l.a)(u.a.mark((function r(i){return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.getCharacteristicInit(e,n).addEventListener("characteristicvaluechanged",(function(n){if(n.target.uuid===E.a.NOTIFY_MESSAGE){var r=a.ab2str(n.target.value.buffer);b.notify.show(r,"custom",3e3,"teal")}else if(n.target.uuid===E.a.CUSTOM_COMMAND_NOTIFY){var i=a.ab2str(n.target.value.buffer);if(a.state.commandOutputShouldRefresh)a.setState({commandOutputShouldRefresh:!1,commandOutput:""},(function(){var e=a.state.commandOutput+i;e.endsWith("&#&")&&(e=e.replace("&#&",""),a.setState({commandOutputShouldRefresh:!0})),a.setState({commandOutput:e})}));else{var s=a.state.commandOutput+i;s.endsWith("&#&")&&(s=s.replace("&#&",""),a.setState({commandOutputShouldRefresh:!0})),a.setState({commandOutput:s})}}else{var c=a.ab2str(n.target.value.buffer),o=t;o.find((function(t){return t.uuid===e}))&&(o.find((function(t){return t.uuid===e})).value=c),o.find((function(t){return t.uuid_label===e}))&&(o.find((function(t){return t.uuid_label===e})).label=c),a.setState({infoList:o})}})),r.next=3,a.getCharacteristicInit(e,n).startNotifications();case 3:i();case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())},a.webBleConnect=function(e){return new Promise(function(){var t=Object(l.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getCharacteristic(E.a.PREFIX+E.a.CUSTOM_INFO_COUNT).then((function(e){return e.readValue()})).then((function(e){return e.buffer})).then(a.ab2str).then(parseInt).then((function(e){console.log("custom-info-count "+e),a.setState({customInfoCount:e})}));case 2:return t.next=4,e.getCharacteristic(E.a.PREFIX+E.a.CUSTOM_COMMAND_COUNT).then((function(e){return e.readValue()})).then((function(e){return e.buffer})).then(a.ab2str).then(parseInt).then((function(t){console.log("custom-command-count "+t),a.setState({customCommandCount:t},(function(){for(var t=[],r=0;r<a.state.customInfoCount;r++){var i=(r+1).toString(16);i="0".repeat(4-i.length)+i,t.push(E.a.PREFIX+E.a.CUSTOM_INFO+i),t.push(E.a.PREFIX+E.a.CUSTOM_INFO_LABEL+i)}for(var s=[],o=0;o<a.state.customCommandCount;o++){var u=(o+1).toString(16);u="0".repeat(4-u.length)+u,s.push(E.a.PREFIX+E.a.CUSTOM_COMMAND_LABEL+u)}n(Promise.all([e.getCharacteristic(E.a.SERVICE_NAME),e.getCharacteristic(E.a.DEVICE_MODEL),e.getCharacteristic(E.a.WIFI_NAME),e.getCharacteristic(E.a.IP_ADDRESS),e.getCharacteristic(E.a.NOTIFY_MESSAGE),e.getCharacteristic(E.a.INPUT_SEP),e.getCharacteristic(E.a.CUSTOM_COMMAND_INPUT),e.getCharacteristic(E.a.CUSTOM_COMMAND_NOTIFY)].concat(Object(c.a)(t.map((function(t){return e.getCharacteristic(t)}))),Object(c.a)(s.map((function(t){return e.getCharacteristic(t)}))))))}))}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},a.ab2str=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},a.getCharacteristic=function(e){return a.state.characteristicsList.find((function(t){return t.uuid===e}))},a.getCharacteristicInit=function(e,t){return t.find((function(t){return t.uuid===e}))},a.inputWifi=function(){a.setState({key:a.state.key.trim().replace(/\|/g,"*"),ssid:a.state.ssid.trim().replace(/\|/g,"*"),password:a.state.password.trim().replace(/\|/g,"*")},(function(){var e;if(""===a.state.ssid&&(e="SSID cannot be empty."),""===a.state.password&&(e="Password cannot be empty."),e)b.notify.show(e,"custom",3e3,"teal");else{a.setState({wifiLock:!0},(function(){return setTimeout((function(){a.setState({wifiLock:!1,wifiReset:!1})}),4e3)}));var t=a.str2abs("".concat(a.state.key,"%&%").concat(a.state.ssid,"%&%").concat(a.state.password,"&#&"));a.sendSeparately(t,E.a.INPUT_SEP)}}))},a.sendCommand=function(e){var t=a.str2abs("".concat(a.state.key,"%&%").concat(e.slice(-4),"&#&"));a.sendSeparately(t,E.a.CUSTOM_COMMAND_INPUT)},a.sendSeparately=function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=u.a.keys(t);case 1:if((e.t1=e.t0()).done){e.next=9;break}return r=e.t1.value,e.next=5,a.getCharacteristic(n).writeValue(t[r]);case 5:return e.next=7,a.wait(.4);case 7:e.next=1;break;case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),a.wait=function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e(!0)}),1e3*t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.waitCamera=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!0,void 0===a.state.infoList.find((function(e){return"IP Address"===e.label}))||""===a.state.infoList.find((function(e){return"IP Address"===e.label})).value){e.next=10;break}case 2:if(!t){e.next=7;break}return e.next=5,fetch("http://"+a.state.infoList.find((function(e){return"IP Address"===e.label})).value+":8000/index.html").then(function(){var e=Object(l.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.ok){e.next=5;break}return e.next=3,a.wait(.5);case 3:e.next=6;break;case 5:t=!1;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch(Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.wait(.5);case 2:case"end":return e.stop()}}),e)}))));case 5:e.next=2;break;case 7:return e.abrupt("return",!0);case 10:return alert("\uc640\uc774\ud30c\uc774\uac00 \uc5f0\uacb0\ub418\uc5b4\uc788\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)}))),a.str2abs=function(e){for(var t="",a=0;a<e.length;a++)""===t?t=e.charCodeAt(a).toString(16):t+=","+e.charCodeAt(a).toString(16);for(var n=t.split(","),r=[];n.length>0;){var i=n.splice(0,20).join(",");r.push(new Uint8Array(i.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer)}return r},a.setIsBlockCodingToFalse=function(){a.setState({isBlockCoding:!1}),a.sendCommand(a.state.commandList.find((function(e){return"stop"===e.label})).uuid)},a.state={supportBluetooth:Boolean(window.navigator.bluetooth),isConnected:!1,serverId:"",ssid:"",password:"",key:"pibox",wifiLock:!1,characteristicsList:[],infoList:[],commandList:[],isBlockCoding:!1,commandOutput:"",commandOutputShouldRefresh:!1,loading:null,charLength:-1,customInfoCount:0,customCommandCount:0,wifiReset:!1,isAndroid:navigator.userAgent.indexOf("Android")>-1||navigator.userAgent.indexOf("Adr")>-1,isIphone:navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iphone")>-1,wifiConnected:!1},E.a)E.a[n]=E.a[n].toLowerCase();return a}return Object(p.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"BluetoothConnect"},r.a.createElement("div",{id:"app"},r.a.createElement(C.a,null),r.a.createElement("img",{src:"img/logo.svg",className:"logo"}),r.a.createElement("div",{className:"panel-container"},this.state.supportBluetooth?null:r.a.createElement("div",{className:"connect-panel panel"},r.a.createElement("div",{className:"panel-title"},"Cannot find web bluetooth."),r.a.createElement("p",null,"Please make sure your device and browser support web bluetooth. Please visit"," ",r.a.createElement("a",{href:"https://github.com/WebBluetoothCG/web-bluetooth/blob/master/implementation-status.md",target:"_brank"},"Here")," ","to check web-bluetooth compatibility.")),!this.state.isConnected&&this.state.supportBluetooth?r.a.createElement("div",{className:"connect-panel panel"},r.a.createElement("img",{src:"img/icon_arrow_back.svg",className:"Icon-arrow_back"}),r.a.createElement("div",{className:"character-button"},r.a.createElement("img",{src:"img/character.svg",className:"character"}),r.a.createElement("div",{className:"Look-it-up"},"Look it up!"),r.a.createElement("div",{className:"PLAi-Bluetooth-"},"PLAi\ub97c \uc6c0\uc9c1\uc77c Bluetooth\ub97c \ucc3e\uc544\ubcfc\uae4c\uc694?"),r.a.createElement("div",{onClick:this.connectDevice},r.a.createElement("img",{src:"img/bluetooth_button.svg",className:"bluetooth_button"})))):null,(this.state.isConnected,null),this.state.isConnected&&(void 0===this.state.infoList.find((function(e){return"IP Address"===e.label}))||""===this.state.infoList.find((function(e){return"IP Address"===e.label})).value)||this.state.wifiReset?r.a.createElement("div",{className:"wifi-panel panel"},r.a.createElement("img",{src:"img/icon_arrow_back.svg",className:"Icon-arrow_back"}),r.a.createElement("div",{className:"WiFi-password-container"},r.a.createElement("div",{className:"wifi-setting-title"},r.a.createElement("span",{className:"WiFi-"},"WiFi \uc124\uc815"),r.a.createElement("img",{src:"img/character2.svg",className:"character2"})),r.a.createElement("div",{className:"wifi-name-container"},r.a.createElement("div",null,r.a.createElement("span",{className:"Wifi-Name"},"WiFi Name"),r.a.createElement("input",{className:"wifi-name-input",placeholder:"  \uc640\uc774\ud30c\uc774 \uc774\ub984(SSID)",value:this.state.ssid,onChange:function(t){return e.setState({ssid:t.target.value})}})),r.a.createElement("div",null,r.a.createElement("span",{className:"Wifi-Password"},"WiFi Password"),r.a.createElement("input",{className:"wifi-password-input",placeholder:"  \uc640\uc774\ud30c\uc774 \ube44\ubc00\ubc88\ud638",value:this.state.password,onChange:function(t){return e.setState({password:t.target.value.replace(/[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/g,"")})},type:"password"}))),r.a.createElement("div",null,r.a.createElement("img",{className:"wifi-button",onClick:this.inputWifi,disabled:this.state.wifiLock,src:this.state.wifiLock?"img/wifing_button.svg":"img/wifi_button.svg"})))):null,!this.state.isConnected||void 0===this.state.infoList.find((function(e){return"IP Address"===e.label}))||""===this.state.infoList.find((function(e){return"IP Address"===e.label})).value||this.state.wifiConnected||this.state.wifiReset?null:r.a.createElement("div",{className:"connect-panel panel"},r.a.createElement("img",{src:"img/icon_arrow_back.svg",onClick:function(){return e.setState({wifiReset:!0})},className:"Icon-arrow_back"}),r.a.createElement("div",{className:"character-button"},r.a.createElement("img",{src:"img/character2.svg",className:"character"}),r.a.createElement("div",{className:"Look-it-up"},"WiFi \uc124\uc815\uc774 \uc644\ub8cc \ub418\uc5c8\uc2b5\ub2c8\ub2e4."),r.a.createElement("div",{className:"PLAi-Bluetooth-"},"PLAi\uc640 \ud568\uaed8 \ub180\uc544\ubcfc\uae4c\uc694?"),r.a.createElement("div",{onClick:function(){return e.setState({wifiConnected:!0})}},r.a.createElement("img",{src:"img/wifi_next.svg",className:"bluetooth_button"}))))),(this.state.isConnected,null),this.state.isConnected&&!this.state.isBlockCoding&&this.state.wifiConnected?r.a.createElement("div",{className:"connect-panel panel"},r.a.createElement("img",{src:"img/icon_arrow_back.svg",onClick:function(){return e.setState({wifiReset:!0})},className:"Icon-arrow_back"}),r.a.createElement("div",{className:"character-button"},r.a.createElement("img",{src:"img/plai_character.svg",className:"character"}),this.state.isConnected&&void 0!==this.state.infoList.find((function(e){return"IP Address"===e.label}))&&""!==this.state.infoList.find((function(e){return"IP Address"===e.label})).value&&void 0!==this.state.infoList.find((function(e){return"Machine ID"===e.label}))&&""!==this.state.infoList.find((function(e){return"Machine ID"===e.label})).value&&!this.state.isBlockCoding&&this.state.wifiConnected?r.a.createElement("div",{onClick:Object(l.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.sendCommand(e.state.commandList.find((function(e){return"camStart"===e.label})).uuid),t.next=3,e.wait(2);case 3:return t.next=5,e.waitCamera();case 5:e.setState({isBlockCoding:!0});case 6:case"end":return t.stop()}}),t)})))},r.a.createElement("img",{src:"img/start_blockcode_button.svg",className:"bluetooth_button"})):r.a.createElement("div",null,r.a.createElement("img",{src:"img/start_blockcode_button_not_available.svg",className:"bluetooth_button"})),r.a.createElement("div",{onClick:Object(l.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.sendCommand(e.state.commandList.find((function(e){return"start"===e.label})).uuid),t.next=3,e.wait(.5);case 3:case"end":return t.stop()}}),t)})))},r.a.createElement("img",{src:"img/start_plai_button.svg",className:"bluetooth_button"})),r.a.createElement("div",{onClick:Object(l.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.sendCommand(e.state.commandList.find((function(e){return"stop"===e.label})).uuid),e.setState({isBlockCoding:!1}),t.next=4,e.wait(.5);case 4:case"end":return t.stop()}}),t)})))},r.a.createElement("img",{src:"img/stop_plai_button.svg",className:"bluetooth_button"})),r.a.createElement("div",{onClick:Object(l.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.sendCommand(e.state.commandList.find((function(e){return"reboot"===e.label})).uuid),t.next=3,e.wait(.5);case 3:case"end":return t.stop()}}),t)})))},r.a.createElement("img",{src:"img/plai_reboot_button.svg",className:"bluetooth_button"})))):null,r.a.createElement("div",{className:"copyright"},"PiBox . Open source under GPL-3.0 license.")))}}]),t}(r.a.Component);var A=function(){return r.a.createElement(g,null)};s.a.render(r.a.createElement(A,null),document.getElementById("root")||document.createElement("div"))},4:function(e,t){e.exports={PREFIX:"00000000-0000-0000-0000-",SERVICE_ID:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0000",SERVICE_NAME:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0001",DEVICE_MODEL:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0002",WIFI_NAME:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0003",IP_ADDRESS:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0004",INPUT:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0005",NOTIFY_MESSAGE:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0006",INPUT_SEP:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0007",CUSTOM_COMMAND_INPUT:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0008",CUSTOM_COMMAND_NOTIFY:"FD2B4448-AA0F-4A15-A62F-EB0BE77A0009",CUSTOM_INFO_LABEL:"FD2BCCCA",CUSTOM_INFO_COUNT:"FD2BCCAA0000",CUSTOM_INFO:"FD2BCCCB",CUSTOM_COMMAND_LABEL:"FD2BCCCC",CUSTOM_COMMAND_COUNT:"FD2BCCAC0000"}},65:function(e,t,a){}},[[104,1,2]]]);
//# sourceMappingURL=main.9002fdfc.chunk.js.map